---
title: 高性能集群搭建指南（二） - 系统配置
date: 2017-05-15 22:05:49
tags:
categories:
- Linux
---

## 系统配置

### hostname hosts
### selinux和防火墙

把SELinux放到第一个来写，主要是因为被SELinux坑过太多次了，并且它也会影响后面的配置工作，详细说明见 `man selinux` 。  

建议在装机完成后马上关闭SELinux。
  

#### SELinux模式
>`SELinux` 更能遵从最小权限的理念。在缺省的 `Enforcing` 情况下，一切均被拒绝，接着有一系列例外的政策来允许系统的每个元素（服务、程序、用户）运作时所需的访问权。当一项服务、程序或用户尝试访问或修改一个它不须用的文件或资源时，它的请求会遭拒绝，而这个行动会被记录下来。
  
由于SELinux未关闭，在搭本地源的时候出现过客户端无法访问的情况。


>`SELinux` 拥有三个基本的操作模式，当中 `enforcing` 是缺省的模式。此外，它还有一个 targeted 或 mls 的修饰语。这管制 `SELinux` 规则的应用有多广泛，当中 targeted 是较宽松的级别。  
>
>- **enforcing**： 这个缺省模式会在系统上启用并实施 `SELinux` 的安全性政策，拒绝访问及记录行动。
>- **permissive**： 在 `permissive` 模式下，`SELinux` 会被启用但不会实施安全性政策，而只会发出警告及记录行动。`permissive` 模式在排除 SELinux 的问题时很有用。
>- **disabled**： `SELinux` 已被停用。  

#### 关闭SELinux

`SELinux` 的配置文件为 `/etc/selinux/config` 
``` bash
$ vim /etc/selinux/config

#将SELinux模式改为disabled
SELINUX=disabled  #默认为enforcing
```

#### 查看SELinux工作 状态

`sestatus` 或 `getenforce`
``` bash
$ sestatus

$ getenforce
```

#### 关于 setenforce
  
`setenforce 0` 将SELinux临时改为 `permissive` 模式，注意并非是 `disabled` 模式。
>DESCRIPTION
>- Use Enforcing or 1 to put SELinux in **enforcing** mode.
>- Use Permissive or 0 to put SELinux in **permissive** mode.

#### 几个链接

#### 关闭防火墙

防火墙关闭后的安全问题有待探讨

``` bash
$ systemctl stop    firewalld
$ systemctl disable firewalld
```


### 本地源 （可选）

这里先介绍一下CentOS的软件包管理工具 `yum` 

>Yum（Yellow dog Updater, Modified）由Duke University团队，修改Yellow Dog Linux的Yellow Dog Updater开发而成，是一个基于RPM包管理的字符前端软件包管理器。能够从指定的服务器自动下载RPM包并且安装，可以处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。被Yellow Dog Linux本身，以及Fedora、Red Hat Enterprise Linux采用。

>FILES
>- /etc/yum.conf
>- /etc/yum/version-groups.conf
>- /etc/yum.repos.d/
>- /etc/yum/pluginconf.d/
>- /var/cache/yum/

#### yum 源


##### 服务端

###### 准备rpm包
在 `CentOS-7-x86_64-Everything-1611.iso` 中有 yum 源中的全部rpm包，故将其中的软件包全部拷到本地即可。

``` bash
$ mount /dev/cdrom /mnt
$ mkdir /yum
$ cp -r /mnt /yum/base
$ ll /yum/base
total 760
-rwxr-xr-x 1 root root  34494 Apr  2 01:25 autorun.ico
-rwxr-xr-x 1 root root    226 Apr  2 01:25 autorun.inf
-rwxr-xr-x 1 root root     14 Apr  2 01:25 CentOS_BuildTag
drwxr-xr-x 3 root root     35 Apr  2 01:25 EFI
-rwxr-xr-x 1 root root    215 Apr  2 01:25 EULA
-rwxr-xr-x 1 root root  18009 Apr  2 01:25 GPL
drwxr-xr-x 3 root root     57 Apr  2 01:25 images
drwxr-xr-x 2 root root    198 Apr  2 01:25 isolinux
-r-xr-xr-x 1 root root  37512 Apr  2 01:25 ldlinux.sys
drwxr-xr-x 2 root root     43 Apr  2 01:25 LiveOS
drwxr-xr-x 2 root root 520192 Apr  2 01:29 Packages
drwxr-xr-x 2 root root   4096 Apr  2 01:29 repodata
-rwxr-xr-x 1 root root   1690 Apr  2 01:29 RPM-GPG-KEY-CentOS-7
-rwxr-xr-x 1 root root   1690 Apr  2 01:29 RPM-GPG-KEY-CentOS-Testing-7
-rwxr-xr-x 1 root root     94 Apr  2 01:29 syslinux.cfg
drwxr-xr-x 2 root root     31 Apr  2 01:29 System Volume Information
-rwxr-xr-x 1 root root   2883 Apr  2 01:29 TRANS.TBL
```


###### 配置repo

``` bash
$ cp -r /etc/yum.repos.d /etc/yum.repos.d.bak
$ cd /etc/yum.repos.d
$ rm -f ./*
$ vim CentOS-Server.repo
```

将以下内容写入 `CentOS-Server.repo`

```
[CentOS-Media]
name=CentOS-$releasever - Media
baseurl=file:///yum/base/
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
```

`Media` 写为其他也可以，`gpgcheck` 为软件包签名的验证，以防软件包损坏或被篡改，这里选择关闭。

###### 更新软件包缓存 

``` bash
$ yum clean all
$ yum makecache
```

这样服务端的 yum 源就配置好了，可以简单地验证是否成功。

``` bash
$ yum install tree -y
```

###### ftp服务器配置

**ftp 安装**

``` bash
$ yum install vsftpd -y
```

**ftp 配置**  
编辑 `/etc/vsftpd/vsftpd.conf`

``` bash
$ echo "anon_root=/yum/" >> /etc/vsftpd/vsftpd.conf
```

**ftp 服务启动**

``` bash
$ systemctl start  vsftpd       #启动服务
$ systemctl enable vsftpd       #启用开机启动
```



##### 客户端

客户端的配置相对来说会快很多，只需要修改`repo` 文件即可

###### 配置 repo

``` bash
$ cp -r /etc/yum.repos.d /etc/yum.repos.d.bak
$ cd /etc/yum.repos.d
$ rm -f ./*
$ vim CentOS-Client.repo
```

将以下内容写入 `CentOS-Client.repo`

``` 
[CentOS-Media]
name=CentOS-$releasever - Media
baseurl=ftp://mic1/base
enable=1
gpgcheck=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7
```


#### epel 源

### IP
### 无密码访问
### InfiniBand 驱动

### NFS文件系统 exports

